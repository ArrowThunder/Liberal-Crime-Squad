
#include "../includes.h"
const string CONST_mapspecialsX01 = "\"Get the fuck out of here.\"";
const string CONST_mapspecialsX02 = "\"Get the hell out of here.\"";
const string CONST_mapspecialsX03 = "\"The best way not to fail is to succeed.\"";
const string CONST_mapspecialsX04 = "\"Great work is done by people who do great work.\"";

const string CONST_mapspecials161 = "The CCS leader is here.";
const string CONST_mapspecials160 = "The CCS leader is ready for you!";
const string CONST_mapspecials159 = "The President is in the Oval Office.";
const string CONST_mapspecials158 = "Secret Service agents ambush the squad!";
const string CONST_mapspecials157 = "The President isn't here... ";
const string CONST_mapspecials156 = "A SWAT team storms the vault!!";
const string CONST_mapspecials155 = "Another SWAT team moves in!!";
const string CONST_mapspecials154 = "The squad loads bricks of cash into a duffel bag.";
const string CONST_mapspecials153 = "A bank teller is available.";
const string CONST_mapspecials152 = "The teller window is empty.";
const string CONST_mapspecials151 = "The squad has nobody that can do the job.";
const string CONST_mapspecials150 = " is no longer recognized.";
const string CONST_mapspecials149 = "and will join the active LCS to avoid arrest.";
const string CONST_mapspecials148 = " opens the vault, ";
const string CONST_mapspecials147 = "The hostage is forced to open the vault.";
const string CONST_mapspecials146 = " opens the vault.";
const string CONST_mapspecials145 = "to the bank's managers.";
const string CONST_mapspecials144 = "Last is the biometric lock that keyed only ";
const string CONST_mapspecials143 = "The money was so close the squad could taste it!";
const string CONST_mapspecials142 = "be bypassed by a computer expert.";
const string CONST_mapspecials141 = "Next is the electronic lock that will have ";
const string CONST_mapspecials140 = "on the other side of this door...";
const string CONST_mapspecials139 = "The squad can only dream of the money ";
const string CONST_mapspecials138 = "be cracked by a security expert.";
const string CONST_mapspecials137 = "First is the combo lock that will have ";
const string CONST_mapspecials136 = "Open the bank vault? (Yes or No)";
const string CONST_mapspecials135 = "but you'll still have to crack the other locks.";
const string CONST_mapspecials134 = " can handle the biometrics, ";
const string CONST_mapspecials133 = "expert, and one of the bank managers.";
const string CONST_mapspecials132 = "You will need a security expert, a computer ";
const string CONST_mapspecials131 = "an electronic lock, and a biometric lock.";
const string CONST_mapspecials130 = "The vault door has three layers: A combo lock, ";
const string CONST_mapspecials129 = "-BEEEP- -BEEEP- -BEEEP-";
const string CONST_mapspecials128 = "\"Jesus! Put some clothes on!\"";
const string CONST_mapspecials127 = "This door is guarded.";
const string CONST_mapspecials126 = "The squad steps into a metal detector.";
const string CONST_mapspecials125 = "The squad flashes ID badges.";
const string CONST_mapspecials124 = "The security checkpoint is abandoned.";
const string CONST_mapspecials123 = "Smash it? (Yes or No)";
const string CONST_mapspecials122 = "You see a display case.";
const string CONST_mapspecials121 = "Start an impromptu news program? (Yes or No)";
const string CONST_mapspecials120 = "You've found a Cable News broadcasting studio.";
const string CONST_mapspecials119 = " Take over the studio? (Yes or No)";
const string CONST_mapspecials118 = "their rush to get out.";
const string CONST_mapspecials117 = "The Cable News broadcasters left the equipment on in";
const string CONST_mapspecials116 = "Interrupt this evening's programming? (Yes or No)";
const string CONST_mapspecials115 = "You've found a radio broadcasting room.";
const string CONST_mapspecials112 = "The radio broadcasters left the equipment on in ";
const string CONST_mapspecials111 = "The Squad has found some very interesting files.";
const string CONST_mapspecials110 = "Open it? (Yes or No)";
const string CONST_mapspecials109 = "You've found a safe.";
const string CONST_mapspecials108 = "Guards are everywhere!";
const string CONST_mapspecials107 = "It's a trap!  The armory is empty.";
const string CONST_mapspecials106 = "The squad finds some body armor.";
const string CONST_mapspecials105 = "The squad finds some M4 Carbines.";
const string CONST_mapspecials104 = "The squad finds some M16 Assault Rifles.";
const string CONST_mapspecials103 = "Jackpot! The squad found a M249 Machine Gun!";
const string CONST_mapspecials102 = "Alarms go off!";
const string CONST_mapspecials101 = "Break in? (Yes or No)";
const string CONST_mapspecials100 = "You've found the armory.";
const string CONST_mapspecials099 = "Wow, it's empty.  That sucks.";
const string CONST_mapspecials098 = "These documents show serious tax evasion.";
const string CONST_mapspecials097 = "The squad will take those.";
const string CONST_mapspecials096 = "Wow, get a load of these love letters. ";
const string CONST_mapspecials095 = "There are some drugs here.";
const string CONST_mapspecials094 = "There are some... very compromising photos here.";
const string CONST_mapspecials093 = "The squad Liberates some expensive jewelery.";
const string CONST_mapspecials092 = "This guy sure had a lot of $100 bills.";
const string CONST_mapspecials091 = "The squad has found a Desert Eagle.";
const string CONST_mapspecials088 = "Destroy it? (Yes or No)";
const string CONST_mapspecials087 = "You see some industrial equipment.";
const string CONST_mapspecials085 = "You see some textile equipment.";
const string CONST_mapspecials084 = "The squad sprays Liberal Graffiti!";
const string CONST_mapspecials083 = "including a list of government backers of the CCS.";
const string CONST_mapspecials082 = ",";
const string CONST_mapspecials081 = "The Squad obtains sensitive information";
const string CONST_mapspecials080 = "Hack it? (Yes or No)";
const string CONST_mapspecials079 = "You've found the Intelligence Supercomputer.";
const string CONST_mapspecials078 = "computer to shut down.";
const string CONST_mapspecials077 = "The security alert has caused the ";
const string CONST_mapspecials076 = "Free the prisoners? (Yes or No)";
const string CONST_mapspecials075 = "prison control room.";
const string CONST_mapspecials074 = "high security ";
const string CONST_mapspecials073 = "medium security ";
const string CONST_mapspecials072 = "low security ";
const string CONST_mapspecials071 = "You've found the ";
const string CONST_mapspecials070 = " wasn't quite convincing...";
const string CONST_mapspecials069 = " wasn't really wrong here.";
const string CONST_mapspecials068 = "concludes that ";
const string CONST_mapspecials067 = " works the room like in Twelve Angry Men, and the jury ";
const string CONST_mapspecials066 = "Attempt to influence them? (Yes or No)";
const string CONST_mapspecials065 = "You've found a Jury in deliberations!";
const string CONST_mapspecials064 = "vacated in a hurry.";
const string CONST_mapspecials063 = "It appears as if this room has been ";
const string CONST_mapspecials062 = "Free them? (Yes or No)";
const string CONST_mapspecials061 = "You see prisoners in the Courthouse jail.";
const string CONST_mapspecials059 = "You see prisoners in the detention room.";
const string CONST_mapspecials058 = "Uh, maybe that idea was Conservative in retrospect...";
const string CONST_mapspecials056 = "You see horrible misshapen creatures in a sealed cage.";
const string CONST_mapspecials055 = "the Squad resigns to just leaving a threatening note.";
const string CONST_mapspecials054 = "After some failed attempts, and a very loud alarm, ";
const string CONST_mapspecials053 = "The reactor is overheating!";
const string CONST_mapspecials052 = "                ";
const string CONST_mapspecials051 = "A deafening alarm sounds!";
const string CONST_mapspecials050 = "The nuclear waste gets released into the state's water supply!";
const string CONST_mapspecials049 = " presses the big red button!";
const string CONST_mapspecials048 = "Mess with the reactor settings? (Yes or No)";
const string CONST_mapspecials047 = "You see the nuclear power plant control room.";
const string CONST_mapspecials046 = "Attempt to release nuclear waste? (Yes or No)";
const string CONST_mapspecials045 = "You see the nuclear waste center control room.";
const string CONST_mapspecials044 = "Employees Only";
const string CONST_mapspecials042 = "on the left.";
const string CONST_mapspecials041 = "The landlord's office is the first door";
const string CONST_mapspecials040 = "the museum displays in the gift shop.";
const string CONST_mapspecials039 = "Welcome to the NPP Nuclear Plant. Please enjoy";
const string CONST_mapspecials036 = "You see fluffy white rabbits in a locked cage.";
const string CONST_mapspecials033 = "\"Get the [heck] out of here.\"";
const string CONST_mapspecials032 = "The bouncer assesses your squad.";
const string CONST_mapspecials031 = "The Conservative scum block the door.";
const string CONST_mapspecials030 = " smirks and lets the squad in.";
const string CONST_mapspecials029 = "caseNOT_REJECTED.txt";
const string CONST_mapspecials028 = "caseREJECTED_WEAPONS.txt";
const string CONST_mapspecials027 = "caseREJECTED_NUDE.txt";
const string CONST_mapspecials026 = "randomCrime.txt";
const string CONST_mapspecials025 = "notRejected.txt";
const string CONST_mapspecials024 = "rejectedBecauseSmellFunny.txt";
const string CONST_mapspecials020 = "";

const string tag_LOOT_CORPFILES = "LOOT_CORPFILES";
const string tag_LOOT = "LOOT";
const string tag_ARMOR_CIVILLIANARMOR = "ARMOR_CIVILLIANARMOR";
const string tag_ARMOR = "ARMOR";
const string tag_ARMOR_ARMYARMOR = "ARMOR_ARMYARMOR";
const string tag_CLIP = "CLIP";
const string tag_CLIP_ASSAULT = "CLIP_ASSAULT";
const string tag_WEAPON = "WEAPON";
const string tag_WEAPON_CARBINE_M4 = "WEAPON_CARBINE_M4";
const string tag_WEAPON_AUTORIFLE_M16 = "WEAPON_AUTORIFLE_M16";
const string tag_CLIP_DRUM = "CLIP_DRUM";
const string tag_WEAPON_M249_MACHINEGUN = "WEAPON_M249_MACHINEGUN";
const string tag_LOOT_CEOTAXPAPERS = "LOOT_CEOTAXPAPERS";
const string tag_LOOT_CEOLOVELETTERS = "LOOT_CEOLOVELETTERS";
const string tag_LOOT_CEOPHOTOS = "LOOT_CEOPHOTOS";
const string tag_LOOT_EXPENSIVEJEWELERY = "LOOT_EXPENSIVEJEWELERY";
const string tag_CLIP_50AE = "CLIP_50AE";
const string tag_WEAPON_DESERT_EAGLE = "WEAPON_DESERT_EAGLE";
const string tag_LOOT_INTHQDISK = "LOOT_INTHQDISK";
const string tag_LOOT_CCS_BACKERLIST = "LOOT_CCS_BACKERLIST";
/*
Copyright (c) 2002,2003,2004 by Tarn Adams                                            //
																					  //
This file is part of Liberal Crime Squad.                                             //
																					//
	Liberal Crime Squad is free software; you can redistribute it and/or modify     //
	it under the terms of the GNU General Public License as published by            //
	the Free Software Foundation; either version 2 of the License, or               //
	(at your option) any later version.                                             //
																					//
	Liberal Crime Squad is distributed in the hope that it will be useful,          //
	but WITHOUT ANY WARRANTY; without even the implied warranty of                  //
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.   See the                  //
	GNU General Public License for more details.                                    //
																					//
	You should have received a copy of the GNU General Public License               //
	along with Liberal Crime Squad; if not, write to the Free Software              //
	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA   02111-1307   USA     //
*/
/*
		This file was created by Chris Johnson (grundee@users.sourceforge.net)
		by copying code from game.cpp.
		To see descriptions of files and functions, see the list at
		the bottom of includes.h in the top src folder.
*/
const string blankString = "";
const string tag_value = "value";
const string tag_attribute = "attribute";
const string tag_skill = "skill";
#include "../creature/creature.h"
#include "../locations/locations.h"
#include "../sitemode/advance.h"
#include "../sitemode/miscactions.h"
#include "../sitemode/sitedisplay.h"
#include "../sitemode/stealth.h"
#include "../items/loottype.h"
#include "../items/loot.h"
#include "../items/money.h"
//#include "../common/consolesupport.h"
// for void set_color(short,short,bool)
#include "../log/log.h"
#include "../common/commonactions.h"
#include "../common/commonactionsCreature.h"
// for void addjuice(DeprecatedCreature &cr, long juice, long cap);
#include "../common/translateid.h"
// for  int getloottype(int id);
//#include "../combat/fight.h"
void enemyattack();
#include "../cursesAlternative.h"
#include "../set_color_support.h"
#include "../locations/locationsPool.h"
extern string string_sleeper;
extern string singleDot;
char run_broadcast(bool tv_broadcast);
#include "../common/creaturePool.h"
#include "../common/creaturePoolHeader.h"
string itemClassClip;
string itemClassWeapon;
string itemClassArmor;
string itemClassLoot;
string itemClassMoney;
/* Used by load() to create items of the correct class. */

bool isThereASiteAlarm();
void setSiteAlarmOne();

void addCrimeToSiteStory(const int crime);
void giveActiveSquadLoot(const string loot);
void claimSiteStory();
vector<NameAndAlignment> getEncounterNameAndAlignment();
void claimSiteStoryOne();
void juiceActiveSquad(const long juice, const long cap);
void giveActiveSquadThisLoot(Item* de);
/* checks if a creature's weapon is suspicious or illegal */
char weaponcheck(const DeprecatedCreature &cr, bool metaldetect = false);
/* checks if a creature's uniform is appropriate to the location */
char hasdisguise(const DeprecatedCreature &cr);
char checkActiveSquadForRejection(const char autoadmit, const bool metaldetect) {
	extern Deprecatedsquadst *activesquad;
	extern short sitetype;
	char rejected = NOT_REJECTED;
	// Size up the squad for entry
	for (int s = 0; s < 6; s++)
	{
		if (activesquad->squad[s])
		{
			// Wrong clothes? Gone
			if (activesquad->squad[s]->is_naked() && activesquad->squad[s]->animalgloss != ANIMALGLOSS_ANIMAL)
				if (rejected > REJECTED_NUDE)rejected = REJECTED_NUDE;
			if (autoadmit < 1 && !hasdisguise(*activesquad->squad[s]))
				if (rejected > REJECTED_DRESSCODE)rejected = REJECTED_DRESSCODE;
			// Busted, cheap, bloody clothes? Gone
			if (autoadmit < 2 && activesquad->squad[s]->get_armor().is_bloody())
				if (rejected > REJECTED_BLOODYCLOTHES)rejected = REJECTED_BLOODYCLOTHES;
			if (autoadmit < 2 && activesquad->squad[s]->get_armor().is_damaged())
				if (rejected > REJECTED_DAMAGEDCLOTHES)rejected = REJECTED_DAMAGEDCLOTHES;
			if (autoadmit < 2 && activesquad->squad[s]->get_armor().get_quality() != 1)
				if (rejected > REJECTED_SECONDRATECLOTHES)rejected = REJECTED_SECONDRATECLOTHES;
			// Suspicious weapons? Gone
			if (autoadmit < 2 && weaponcheck(*activesquad->squad[s], metaldetect)>0)
				if (rejected > REJECTED_WEAPONS)rejected = REJECTED_WEAPONS;
			// Fail a tough disguise check? Gone
			if (autoadmit < 1 && disguisesite(sitetype) && !(activesquad->squad[s]->skill_check(SKILL_DISGUISE, DIFFICULTY_CHALLENGING)))
				if (rejected > REJECTED_SMELLFUNNY)rejected = REJECTED_SMELLFUNNY;
			// Underage? Gone
			if (autoadmit < 1 && activesquad->squad[s]->age < 18)
				if (rejected > REJECTED_UNDERAGE)rejected = REJECTED_UNDERAGE;
		}
	}
	return rejected;
}
Item* create_item(const std::string& inputXml)
{
	Item* it = NULL;
	CMarkup xml;
	xml.SetDoc(inputXml);
	xml.FindElem();
	string itemclass = xml.GetTagName();
	if (itemclass == itemClassClip)
		it = new Clip(inputXml);
	else if (itemclass == itemClassWeapon)
		it = new Weapon(inputXml);
	else if (itemclass == itemClassArmor)
		it = new Armor(inputXml);
	else if (itemclass == itemClassLoot)
		it = new Loot(inputXml);
	else if (itemclass == itemClassMoney)
		it = new Money(inputXml);
	return it;
}
vector<NameAndAlignment> getEncounterNameAndAlignment();
void makecreature(const int x, const short type);
void special_bouncer_greet_squad()
{
	vector<NameAndAlignment> encounter = getEncounterNameAndAlignment();
	extern short cursite;
	// add a bouncer if there isn't one in the first slot
	// IsaacG Change in behavior: adds a bouncer whether or not there is one in the first slot
	if (!isThereASiteAlarm() && LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) != RENTING_PERMANENT)
	{
		if (LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) == RENTING_CCS)
		{
			makecreature(0, CREATURE_CCS_VIGILANTE);
			makecreature(1, CREATURE_CCS_VIGILANTE);
		}
		else //if (!encounter[0].exists || encounter[0].type != CREATURE_BOUNCER)
		{
			makecreature(0, CREATURE_BOUNCER);
			makecreature(1, CREATURE_BOUNCER);
		}
	}
}
void emptyEncounter();
map<int, vector<string> > rejectionReasons;
map<int, vector<string> > caseRejectionReasons;
// the vector<string> 'caseREJECTED' and 'rejected' are similar but not identicle.
// TODO the precise differences should be made more apparant
vector<string> rejectedBecauseSmellFunny;
vector<string> notRejected;
vector<string> randomCrime;
vector<string> caseREJECTED_NUDE;
vector<string> caseREJECTED_WEAPONS;
vector<string> caseNOT_REJECTED;
const string mostlyendings = "mostlyendings\\";
#include "../customMaps.h"
vector<file_and_text_collection> map_specials_text_file_collection = {
customText(&rejectedBecauseSmellFunny, mostlyendings + CONST_mapspecials024),
	customText(&notRejected, mostlyendings + CONST_mapspecials025),
	customText(&randomCrime, mostlyendings + CONST_mapspecials026),
	customText(&caseREJECTED_NUDE, mostlyendings + CONST_mapspecials027),
	customText(&caseREJECTED_WEAPONS, mostlyendings + CONST_mapspecials028),
	customText(&caseNOT_REJECTED, mostlyendings + CONST_mapspecials029),
};
char sizeUpSquadForEntry(const bool autoadmit) {

	extern short sitetype;
	extern Deprecatedsquadst *activesquad;
	extern short cursite;
	extern Log gamelog;
	extern DeprecatedCreature encounter[ENCMAX];
	extern short lawList[LAWNUM];

	char rejected = NOT_REJECTED;
	// Size up the squad for entry
	if (!autoadmit)
	{
		for (int s = 0; s < 6; s++)
		{
			if (activesquad->squad[s])
			{
				// Wrong clothes? Gone
				if (activesquad->squad[s]->is_naked() && activesquad->squad[s]->animalgloss != ANIMALGLOSS_ANIMAL)
					if (rejected > REJECTED_NUDE)rejected = REJECTED_NUDE;
				if (!hasdisguise(*activesquad->squad[s]))
					if (rejected > REJECTED_DRESSCODE)rejected = REJECTED_DRESSCODE;
				// Busted, cheap, bloody clothes? Gone
				if (activesquad->squad[s]->get_armor().is_bloody())
					if (rejected > REJECTED_BLOODYCLOTHES)rejected = REJECTED_BLOODYCLOTHES;
				if (activesquad->squad[s]->get_armor().is_damaged())
					if (rejected > REJECTED_DAMAGEDCLOTHES)rejected = REJECTED_DAMAGEDCLOTHES;
				if (activesquad->squad[s]->get_armor().get_quality() != 1)
					if (rejected > REJECTED_SECONDRATECLOTHES)rejected = REJECTED_SECONDRATECLOTHES;
				// Suspicious weapons? Gone
				if (weaponcheck(*activesquad->squad[s]) > 0)
					if (rejected > REJECTED_WEAPONS)rejected = REJECTED_WEAPONS;
				// Fail a tough disguise check? Gone
				if (disguisesite(sitetype) && !(activesquad->squad[s]->skill_check(SKILL_DISGUISE, DIFFICULTY_CHALLENGING)))
					if (rejected > REJECTED_SMELLFUNNY)rejected = REJECTED_SMELLFUNNY;
				// Underage? Gone
				if (activesquad->squad[s]->age < 18)
					if (rejected > REJECTED_UNDERAGE)rejected = REJECTED_UNDERAGE;
				// Not a gentleman by their definition?
				if (sitetype == SITE_BUSINESS_CIGARBAR &&
					(activesquad->squad[s]->gender_conservative != GENDER_MALE ||
						activesquad->squad[s]->gender_liberal == GENDER_FEMALE) &&
					lawList[LAW_WOMEN] < 1)
				{
					// Are you passing as a man? Are you skilled enough to pull it off?
					if (activesquad->squad[s]->gender_liberal == GENDER_FEMALE)
					{
						// Not a man by your own definition either
						if (rejected > REJECTED_FEMALE)rejected = REJECTED_FEMALE;
					}
					else if (disguisesite(sitetype) && !(activesquad->squad[s]->skill_check(SKILL_DISGUISE, DIFFICULTY_HARD)) && lawList[LAW_GAY] != 2)
					{
						// Not skilled enough to pull it off
						if (rejected > REJECTED_FEMALEISH)rejected = REJECTED_FEMALEISH;
					}
				}
				// High security in gentleman's club? Gone
				if (sitetype == SITE_BUSINESS_CIGARBAR && LocationsPool::getInstance().get_specific_integer(INT_ISTHISPLACEHIGHSECURITY,cursite))
					if (rejected > REJECTED_GUESTLIST)rejected = REJECTED_GUESTLIST;
				if (LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) == RENTING_CCS && LocationsPool::getInstance().getLocationType(cursite) != SITE_BUSINESS_BARANDGRILL)
					rejected = REJECTED_CCS;
			}
		}
		moveAlt(17, 1);
		if (rejectionReasons.count(rejected)) {
			set_color_easy(RED_ON_BLACK_BRIGHT);
			addstrAlt(pickrandom(rejectionReasons[rejected]), gamelog);
		}
		else
			switch (rejected)
			{
			case REJECTED_SMELLFUNNY:
				set_color_easy(RED_ON_BLACK_BRIGHT);
				if (!LCSrandom(len(rejectedBecauseSmellFunny) - 1)) {
					if (lawList[LAW_FREESPEECH] == -2)addstrAlt(CONST_mapspecials033, gamelog);
					else if (lawList[LAW_FREESPEECH] == 2)addstrAlt(CONST_mapspecialsX01, gamelog);
					else addstrAlt(CONST_mapspecialsX02, gamelog);
				}
				else {
					addstrAlt(pickrandom(rejectedBecauseSmellFunny), gamelog);
				}
				break;
			case NOT_REJECTED:
				set_color_easy(GREEN_ON_BLACK_BRIGHT);
				addstrAlt(pickrandom(notRejected), gamelog);
				break;
			}
		gamelog.newline();
		pressAnyKey();
	}
	else {
		encounter[0].exists = 0;
	}
	return rejected;
}
void special_bouncer_assess_squad()
{
	extern short cursite;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern DeprecatedCreature encounter[ENCMAX];

	if (LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) == RENTING_PERMANENT) return;
	bool autoadmit = 0;
	char sleepername[80];
	emptyEncounter();
	special_bouncer_greet_squad();
	{
		string name = getSleeperBouncerName(cursite);
		if (name.size()) {
			autoadmit = 1;
			strcpy(sleepername, name.data());
			strcpy(encounter[0].name, sleepername);
			encounter[0].align = 1;
		}

	}
	//clearmessagearea();
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	moveAlt(16, 1);
	if (autoadmit)
	{
		addstrAlt(string_sleeper, gamelog);
		addstrAlt(sleepername, gamelog);
		addstrAlt(CONST_mapspecials030, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
	}
	else
	{
		if (LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) == RENTING_CCS)
			addstrAlt(CONST_mapspecials031, gamelog);
		else
			addstrAlt(CONST_mapspecials032, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = SPECIAL_CLUB_BOUNCER_SECONDVISIT;
	}
	printencounter();
	pressAnyKey();
	char rejected = sizeUpSquadForEntry(autoadmit);
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	for (int dx = -1; dx <= 1; dx++)
		for (int dy = -1; dy <= 1; dy++)
		{
			if (levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag & SITEBLOCK_DOOR)
			{
				if (rejected < NOT_REJECTED)
				{
					levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag |= SITEBLOCK_LOCKED;
					levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag |= SITEBLOCK_CLOCK;
				}
				else levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
			}
		}
	encounter[0].cantbluff = 1;
}
void special_lab_cosmetics_cagedanimals()
{
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials036, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials062);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_CAGE, actual))
			{
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				sitecrime++;
				juiceparty(3, 100);
				addCrimeToSiteStory(CRIME_FREE_RABBITS);
				criminalizeparty(LAWFLAG_VANDALISM);
			}
			if (actual)
			{
				alienationcheck(0);
				noticecheck(-1);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_readsign(int sign)
{
	extern short cursite;
	clearmessagearea();
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	switch (sign) //TODO: Log these?
	{
	case SPECIAL_SIGN_ONE:
		switch (LocationsPool::getInstance().getLocationType(cursite))
		{
		default:
			mvaddstrAlt(16, 1, CONST_mapspecialsX03);
			break;
		case SITE_INDUSTRY_NUCLEAR:
			mvaddstrAlt(16, 1, CONST_mapspecials039);
			mvaddstrAlt(17, 1, CONST_mapspecials040);
			break;
		case SITE_RESIDENTIAL_TENEMENT:
		case SITE_RESIDENTIAL_APARTMENT:
		case SITE_RESIDENTIAL_APARTMENT_UPSCALE:
			mvaddstrAlt(16, 1, CONST_mapspecials041);
			mvaddstrAlt(17, 1, CONST_mapspecials042);
			break;
		}
		break;
	case SPECIAL_SIGN_TWO:
		switch (LocationsPool::getInstance().getLocationType(cursite))
		{
		default:
			mvaddstrAlt(16, 1, CONST_mapspecialsX04);
			break;
		}
		break;
	case SPECIAL_SIGN_THREE:
		switch (LocationsPool::getInstance().getLocationType(cursite))
		{
		default:
			mvaddstrAlt(16, 1, CONST_mapspecials044);
			break;
		}
		break;
	}
	pressAnyKey();
}
void special_nuclear_onoff()
{
	extern Deprecatedsquadst *activesquad;
	extern int sitecrime;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern short lawList[LAWNUM];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		if (lawList[LAW_NUCLEARPOWER] == 2)
		{
			mvaddstrAlt(16, 1, CONST_mapspecials045, gamelog);
			gamelog.newline();
			mvaddstrAlt(17, 1, CONST_mapspecials046);
		}
		else
		{
			mvaddstrAlt(16, 1, CONST_mapspecials047, gamelog);
			gamelog.newline();
			mvaddstrAlt(17, 1, CONST_mapspecials048);
		}
		int c = getkeyAlt();
		if (c == 'y')
		{
			clearmessagearea();
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			char max = DIFFICULTY_HARD;
			DeprecatedCreature* maxs = 0;
			for (int p = 0; p < 6; p++)
			{
				if (activesquad->squad[p] != NULL && activesquad->squad[p]->alive)
				{
					if (activesquad->squad[p]->skill_check(SKILL_SCIENCE, max))
					{
						maxs = activesquad->squad[p];
						break;
					}
				}
			}
			if (maxs)
			{
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, maxs->name, gamelog);
				addstrAlt(CONST_mapspecials049, gamelog);
				gamelog.newline();
				pressAnyKey();
				mvaddstrAlt(17, 1, singleDot, gamelog);
				pressAnyKey();
				addstrAlt(singleDot, gamelog);
				pressAnyKey();
				addstrAlt(singleDot, gamelog);
				pressAnyKey();
				if (lawList[LAW_NUCLEARPOWER] == 2)
				{
					mvaddstrAlt(17, 1, CONST_mapspecials050, gamelog);
					gamelog.newline();
					change_public_opinion(VIEW_NUCLEARPOWER, 15, 0, 95);
					change_public_opinion(VIEW_LIBERALCRIMESQUADPOS, -50, 0, 0);
					pressAnyKey();
					juiceparty(40, 1000); // Instant juice!
					sitecrime += 25; //Shutdown Site
					addCrimeToSiteStory(CRIME_SHUTDOWNREACTOR);
				}
				else
				{
					mvaddstrAlt(16, 1, CONST_mapspecials051, gamelog);
					gamelog.newline();
					addstrAlt(CONST_mapspecials052); // Remove remaining part of previous text.
					mvaddstrAlt(17, 1, CONST_mapspecials053, gamelog);
					gamelog.newline();
					change_public_opinion(VIEW_NUCLEARPOWER, 15, 0, 95);
					pressAnyKey();
					juiceparty(100, 1000); // Instant juice!
					sitecrime += 50; //Shutdown Site
					addCrimeToSiteStory(CRIME_SHUTDOWNREACTOR);
				}
			}
			else
			{
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials054, gamelog);
				mvaddstrAlt(17, 1, CONST_mapspecials055, gamelog);
				gamelog.newline();
				pressAnyKey();
				juiceparty(15, 500);
			}
			setSiteAlarmOne();
			alienationcheck(1);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			sitecrime += 5;
			criminalizeparty(LAWFLAG_TERRORISM);
			return;
		}
		else if (c == 'n')return;
	}
}
void fillEncounter(CreatureTypes c, int numleft);
void special_lab_genetic_cagedanimals()
{
	extern short mode;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials056, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials062);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_CAGE_HARD, actual))
			{
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				sitecrime++;
				juiceparty(5, 200);
				addCrimeToSiteStory(CRIME_FREE_BEASTS);
				criminalizeparty(LAWFLAG_VANDALISM);
				if (!LCSrandom(2))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials058, gamelog);
					gamelog.newline();
					int numleft = LCSrandom(6) + 1;
					fillEncounter(CREATURE_GENETIC, numleft);
					if (mode == GAMEMODE_CHASECAR ||
						mode == GAMEMODE_CHASEFOOT)printchaseencounter();
					else printencounter();
					pressAnyKey();
					setSiteAlarmOne();
					alienationcheck(1);
				}
				else
				{
					alienationcheck(0);
				}
			}
			else if (actual)
			{
				noticecheck(-1);
			}
			if (actual)
			{
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_policestation_lockup()
{
	extern coordinatest loc_coord;
	extern short mode;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials059, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials062);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_CELL, actual))
			{
				int numleft = LCSrandom(8) + 2;
				fillEncounter(CREATURE_PRISONER, numleft);
				juiceparty(50, 1000);
				sitecrime += 20;
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				if (mode == GAMEMODE_CHASECAR ||
					mode == GAMEMODE_CHASEFOOT)printchaseencounter();
				else printencounter();
				refreshAlt();
				partyrescue(SPECIAL_POLICESTATION_LOCKUP);
			}
			if (actual)
			{
				alienationcheck(1);
				noticecheck(-1, DIFFICULTY_HARD);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
				sitecrime += 2;
				addCrimeToSiteStory(CRIME_POLICE_LOCKUP);
				criminalizeparty(LAWFLAG_HELPESCAPE);
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_courthouse_lockup()
{
	extern short mode;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials061, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials062);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_CELL, actual))
			{
				int numleft = LCSrandom(8) + 2;
				fillEncounter(CREATURE_PRISONER, numleft);
				juiceparty(50, 1000);
				sitecrime += 20;
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				if (mode == GAMEMODE_CHASECAR ||
					mode == GAMEMODE_CHASEFOOT)printchaseencounter();
				else printencounter();
				refreshAlt();
				partyrescue(SPECIAL_COURTHOUSE_LOCKUP);
			}
			if (actual)
			{
				alienationcheck(1);
				noticecheck(-1, DIFFICULTY_HARD);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
				sitecrime += 3;
				addCrimeToSiteStory(CRIME_COURTHOUSE_LOCKUP);
				criminalizeparty(LAWFLAG_HELPESCAPE);
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_courthouse_jury()
{
	extern short sitealienate;
	extern short mode;
	extern Deprecatedsquadst *activesquad;
	extern int sitecrime;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	if (isThereASiteAlarm() || sitealienate)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials063, gamelog);
		mvaddstrAlt(17, 1, CONST_mapspecials064, gamelog);
		gamelog.newline();
		pressAnyKey();
		return;
	}
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials065, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials066);
		int c = getkeyAlt();
		if (c == 'y')
		{
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			int maxattack = 0;
			int maxp = -1;
			for (int p = 0; p < 6; p++)
			{
				if (activesquad->squad[p] != NULL)
				{
					if (activesquad->squad[p]->alive)
					{
						if (activesquad->squad[p]->get_attribute(ATTRIBUTE_CHARISMA, true) +
							activesquad->squad[p]->get_attribute(ATTRIBUTE_INTELLIGENCE, true) +
							activesquad->squad[p]->get_skill(SKILL_PERSUASION) +
							activesquad->squad[p]->get_skill(SKILL_LAW) > maxattack)
						{
							maxattack = activesquad->squad[p]->get_attribute(ATTRIBUTE_CHARISMA, true) +
								activesquad->squad[p]->get_attribute(ATTRIBUTE_INTELLIGENCE, true) +
								activesquad->squad[p]->get_skill(SKILL_PERSUASION) +
								activesquad->squad[p]->get_skill(SKILL_LAW);
							maxp = p;
						}
					}
				}
			}
			if (maxp > -1)
			{
				int p = maxp;
				activesquad->squad[p]->train(SKILL_PERSUASION, 20);
				activesquad->squad[p]->train(SKILL_LAW, 20);
				if (activesquad->squad[p]->skill_check(SKILL_PERSUASION, DIFFICULTY_HARD) &&
					activesquad->squad[p]->skill_check(SKILL_LAW, DIFFICULTY_CHALLENGING))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, activesquad->squad[p]->name, gamelog);
					addstrAlt(CONST_mapspecials067, gamelog);
					mvaddstrAlt(17, 1, CONST_mapspecials068, gamelog);//XXX: This is very awkward grammar.
					addstrAlt(pickrandom(randomCrime), gamelog);
					addstrAlt(CONST_mapspecials069, gamelog);
					gamelog.newline();
					pressAnyKey();
					alienationcheck(0);
					noticecheck(-1);
					//INSTANT JUICE BONUS
					addjuice(*(activesquad->squad[p]), 25, 200);
				}
				else
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, activesquad->squad[p]->name, gamelog);
					addstrAlt(CONST_mapspecials070, gamelog);
					gamelog.newline();
					pressAnyKey();
					int numleft = 12;
					fillEncounter(CREATURE_JUROR, numleft);
					if (mode == GAMEMODE_CHASECAR ||
						mode == GAMEMODE_CHASEFOOT)printchaseencounter();
					else printencounter();
					refreshAlt();
					setSiteAlarmOne();
					sitealienate = 2;
					sitecrime += 10;
					addCrimeToSiteStory(CRIME_JURYTAMPERING);
					criminalizeparty(LAWFLAG_JURY);
				}
			}
			return;
		}
		else if (c == 'n')return;
	}
}
#include "../items/lootTypePoolItem.h"
void special_prison_control(short prison_control_type)
{
	extern short mode;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern short lawList[LAWNUM];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials071, gamelog);
		if (prison_control_type == SPECIAL_PRISON_CONTROL_LOW)
			addstrAlt(CONST_mapspecials072, gamelog);
		else if (prison_control_type == SPECIAL_PRISON_CONTROL_MEDIUM)
			addstrAlt(CONST_mapspecials073, gamelog);
		else if (prison_control_type == SPECIAL_PRISON_CONTROL_HIGH)
			addstrAlt(CONST_mapspecials074, gamelog);
		addstrAlt(CONST_mapspecials075, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials076);
		int c = getkeyAlt();
		if (c == 'y')
		{
			int numleft = LCSrandom(8) + 2;
			if (prison_control_type == SPECIAL_PRISON_CONTROL_LOW)
			{
				switch (lawList[LAW_DEATHPENALTY])
				{
				case -1: numleft = LCSrandom(6) + 2; break;
				case -2: numleft = LCSrandom(3) + 1; break;
				}
			}
			else if (prison_control_type == SPECIAL_PRISON_CONTROL_MEDIUM)
			{
				switch (lawList[LAW_DEATHPENALTY])
				{
				case 2: numleft = LCSrandom(4) + 1;
				case 1: numleft = LCSrandom(6) + 1;
				}
			}
			else if (prison_control_type == SPECIAL_PRISON_CONTROL_HIGH)
			{
				switch (lawList[LAW_DEATHPENALTY])
				{
				case  2: numleft = 0; break;
				case  1: numleft = LCSrandom(4); break;
				case -1: numleft += LCSrandom(4); break;
				case -2: numleft += LCSrandom(4) + 2; break;
				}
			}
			fillEncounter(CREATURE_PRISONER, numleft);
			int time = 20 + LCSrandom(10);
			if (time < 1)time = 1;
			if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
			if (mode == GAMEMODE_CHASECAR ||
				mode == GAMEMODE_CHASEFOOT)printchaseencounter();
			else printencounter();
			refreshAlt();
			partyrescue(prison_control_type);
			alienationcheck(1);
			noticecheck(-1);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			sitecrime += 30;
			juiceparty(50, 1000);
			addCrimeToSiteStory(CRIME_PRISON_RELEASE);
			criminalizeparty(LAWFLAG_HELPESCAPE);
			return;
		}
		else if (c == 'n')return;
	}
}
void special_intel_supercomputer()
{
	extern CCSexposure ccsexposure;
	extern short sitealienate;
	extern char endgamestate;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	if (isThereASiteAlarm() || sitealienate)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials077, gamelog);
		mvaddstrAlt(17, 1, CONST_mapspecials078, gamelog);
		gamelog.newline();
		pressAnyKey();
		return;
	}
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials079, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials080);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (hack(HACK_SUPERCOMPUTER, actual))
			{
				clearmessagearea();
				//char *loot;
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials081, gamelog);
				if (endgamestate >= ENDGAME_CCS_APPEARANCE && endgamestate < ENDGAME_CCS_DEFEATED && ccsexposure < CCSEXPOSURE_LCSGOTDATA)
				{
					addstrAlt(CONST_mapspecials082, gamelog);
					mvaddstrAlt(17, 1, CONST_mapspecials083, gamelog);
					giveActiveSquadLoot(tag_LOOT_CCS_BACKERLIST);
					ccsexposure = CCSEXPOSURE_LCSGOTDATA;
				}
				else
				{
					addstrAlt(singleDot, gamelog);
				}
				gamelog.newline();
				juiceparty(50, 1000);
				giveActiveSquadLoot(tag_LOOT_INTHQDISK);
				pressAnyKey();
			}
			if (actual)
			{
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				alienationcheck(1);
				noticecheck(-1, DIFFICULTY_HARD);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
				sitecrime += 3;
				addCrimeToSiteStory(CRIME_HACK_INTEL);
				criminalizeparty(LAWFLAG_TREASON);
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_graffiti()
{
	extern short cursite;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	clearmessagearea();
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	mvaddstrAlt(16, 1, CONST_mapspecials084, gamelog);
	gamelog.newline();
	claimSiteStoryOne();
	pressAnyKey();
	int time = 20 + LCSrandom(10);
	if (time < 1)time = 1;
	if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
	alienationcheck(0);
	noticecheck(-1, DIFFICULTY_HARD);
	levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].flag |= SITEBLOCK_GRAFFITI;
	levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].flag &= ~(SITEBLOCK_GRAFFITI_CCS | SITEBLOCK_GRAFFITI_OTHER);
	if (!LocationsPool::getInstance().get_specific_integer(INT_ISTHISPLACEHIGHSECURITY,cursite))
	{
		LocationsPool::getInstance().eraseAndReplaceGraffiti(cursite, loc_coord.locx, loc_coord.locy, loc_coord.locz);
	}
	sitecrime++;
	juiceActiveSquad(1, 50);
	criminalizeparty(LAWFLAG_VANDALISM); 
	addCrimeToSiteStory(CRIME_TAGGING);
	return;
}
void special_sweatshop_equipment()
{
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials085, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials088);
		int c = getkeyAlt();
		if (c == 'y')
		{
			int time = 20 + LCSrandom(10);
			if (time < 1)time = 1;
			if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
			alienationcheck(0);
			noticecheck(-1, DIFFICULTY_HEROIC);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].flag |= SITEBLOCK_DEBRIS;
			sitecrime++;
			juiceparty(5, 100);
			addCrimeToSiteStory(CRIME_BREAK_SWEATSHOP);
			criminalizeparty(LAWFLAG_VANDALISM);
			return;
		}
		else if (c == 'n')return;
	}
}
void special_polluter_equipment()
{
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials087, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials088);
		int c = getkeyAlt();
		if (c == 'y')
		{
			int time = 20 + LCSrandom(10);
			if (time < 1)time = 1;
			if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
			change_public_opinion(VIEW_POLLUTION, 2, 1, 70);
			alienationcheck(0);
			noticecheck(-1, DIFFICULTY_HEROIC);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].flag |= SITEBLOCK_DEBRIS;
			sitecrime += 2;
			juiceparty(5, 100);
			addCrimeToSiteStory(CRIME_BREAK_FACTORY);
			criminalizeparty(LAWFLAG_VANDALISM);
			return;
		}
		else if (c == 'n')return;
	}
}
void special_house_photos()
{
	extern bool deagle;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern vector<WeaponType *> weapontype;
	extern vector<ClipType *> cliptype;
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials109, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials110);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_SAFE, actual))
			{
				bool empty = true;
				if (deagle == false)
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials091, gamelog);
					gamelog.newline();
					pressAnyKey();
					Weapon* de = new Weapon(*weapontype[getweapontype(tag_WEAPON_DESERT_EAGLE)]);
					Clip r(*cliptype[getcliptype(tag_CLIP_50AE)]);
					de->reload(r);
					giveActiveSquadThisLoot(de);
					Item *it = new Clip(*cliptype[getcliptype(tag_CLIP_50AE)], 9);
					giveActiveSquadThisLoot(it);
					deagle = true;
					empty = false;
				}
				if (LCSrandom(2))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials092, gamelog);
					gamelog.newline();
					pressAnyKey();
					Item *it = new Money(1000 * (1 + LCSrandom(10)));
					giveActiveSquadThisLoot(it);
					empty = false;
				}
				if (LCSrandom(2))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials093, gamelog);
					gamelog.newline();
					pressAnyKey();
					giveActiveSquadThisLoot(getNewLoot(tag_LOOT_EXPENSIVEJEWELERY, 3));
					empty = false;
				}
				if (!LCSrandom(3))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials094, gamelog);
					gamelog.newline();
					pressAnyKey();
					giveActiveSquadThisLoot(getNewLoot(tag_LOOT_CEOPHOTOS));
					empty = false;
				}
				if (!LCSrandom(3))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials095, gamelog);
					gamelog.newline();
					pressAnyKey();
					empty = false;
				}
				if (!LCSrandom(3))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials096, gamelog);
					mvaddstrAlt(17, 1, CONST_mapspecials097);
					gamelog.newline();
					pressAnyKey();
					giveActiveSquadThisLoot(getNewLoot(tag_LOOT_CEOLOVELETTERS));
					empty = false;
				}
				if (!LCSrandom(3))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials098, gamelog);
					gamelog.newline();
					pressAnyKey();
					giveActiveSquadThisLoot(getNewLoot(tag_LOOT_CEOTAXPAPERS));
					empty = false;
				}
				if (empty)
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials099, gamelog);
					gamelog.newline();
					pressAnyKey();
				}
				else
				{
					juiceparty(50, 1000);
					sitecrime += 40;
					addCrimeToSiteStory(CRIME_HOUSE_PHOTOS);
					criminalizeparty(LAWFLAG_THEFT);
					int time = 20 + LCSrandom(10);
					if (time < 1)time = 1;
					if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				}
			}
			if (actual)
			{
				alienationcheck(0);
				noticecheck(-1);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_armory()
{
	extern bool m249;
	extern short cursite;
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern vector<WeaponType *> weapontype;
	extern vector<ClipType *> cliptype;
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials100, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials101);
		int c = getkeyAlt();
		if (c == 'y')
		{
			clearmessagearea();
			setSiteAlarmOne();
			set_color_easy(RED_ON_BLACK_BRIGHT);
			mvaddstrAlt(16, 1, CONST_mapspecials102, gamelog);
			gamelog.newline();
			pressAnyKey();
			bool empty = true;
			Item *it;
			if (m249 == false && LocationsPool::getInstance().getLocationType(cursite) == SITE_GOVERNMENT_ARMYBASE)
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials103, gamelog);
				gamelog.newline();
				pressAnyKey();
				Weapon* de = new Weapon(*weapontype[getweapontype(tag_WEAPON_M249_MACHINEGUN)]);
				Clip r(*cliptype[getcliptype(tag_CLIP_DRUM)]);
				de->reload(r);
				giveActiveSquadThisLoot(de);
				it = new Clip(*cliptype[getcliptype(tag_CLIP_DRUM)], 9);
				giveActiveSquadThisLoot(it);
				m249 = true;
				empty = false;
			}
			if (LCSrandom(2))
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials104, gamelog);
				gamelog.newline();
				pressAnyKey();
				int num = 0;
				do
				{
					Weapon* de = new Weapon(*weapontype[getweapontype(tag_WEAPON_AUTORIFLE_M16)]);
					Clip r(*cliptype[getcliptype(tag_CLIP_ASSAULT)]);
					de->reload(r);
					giveActiveSquadThisLoot(de);
					it = new Clip(*cliptype[getcliptype(tag_CLIP_ASSAULT)], 5);
					giveActiveSquadThisLoot(it);
					num++;
				} while (num < 2 || (LCSrandom(2) && num < 5));
				empty = false;
			}
			if (LCSrandom(2))
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials105, gamelog);
				gamelog.newline();
				pressAnyKey();
				int num = 0;
				do
				{
					Weapon* de = new Weapon(*weapontype[getweapontype(tag_WEAPON_CARBINE_M4)]);
					Clip r(*cliptype[getcliptype(tag_CLIP_ASSAULT)]);
					de->reload(r);
					giveActiveSquadThisLoot(de);
					it = new Clip(*cliptype[getcliptype(tag_CLIP_ASSAULT)], 5);
					giveActiveSquadThisLoot(it);
					num++;
				} while (num < 2 || (LCSrandom(2) && num < 5));
				empty = false;
			}
			if (LCSrandom(2))
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials106, gamelog);
				gamelog.newline();
				pressAnyKey();
				int num = 0;
				do
				{
					Armor* de;
					if (LocationsPool::getInstance().getLocationType(cursite) == SITE_GOVERNMENT_ARMYBASE)
						de = new Armor(getarmortype(tag_ARMOR_ARMYARMOR));
					else
						de = new Armor(getarmortype(tag_ARMOR_CIVILLIANARMOR));
					giveActiveSquadThisLoot(de);
					num++;
				} while (num < 2 || (LCSrandom(2) && num < 5));
				empty = false;
			}
			if (empty)
			{
				criminalizeparty(LAWFLAG_TREASON);
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials107, gamelog);
				gamelog.newline();
				pressAnyKey();
				int numleft = LCSrandom(8) + 2;
				if (LocationsPool::getInstance().getLocationType(cursite) == SITE_GOVERNMENT_ARMYBASE) {
					fillEncounter(CREATURE_SOLDIER, numleft);
				}
				else {
					fillEncounter(CREATURE_MERC, numleft);
				}
			}
			else
			{
				juiceparty(50, 1000);
				sitecrime += 40;
				addCrimeToSiteStory(CRIME_ARMORY);
				criminalizeparty(LAWFLAG_THEFT);
				criminalizeparty(LAWFLAG_TREASON);
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials108, gamelog);
				gamelog.newline();
				pressAnyKey();
				int numleft = LCSrandom(4) + 2;
				if (LocationsPool::getInstance().getLocationType(cursite) == SITE_GOVERNMENT_ARMYBASE) {
					fillEncounter(CREATURE_SOLDIER, numleft);
				}
				else {
					fillEncounter(CREATURE_MERC, numleft);
				}
			}
			alienationcheck(0);
			noticecheck(-1);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			return;
		}
		else if (c == 'n')return;
	}
}
void special_corporate_files()
{
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials109, gamelog);
		gamelog.newline();
		mvaddstrAlt(17, 1, CONST_mapspecials110);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			if (unlock(UNLOCK_SAFE, actual))
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials111, gamelog);
				gamelog.newline();
				giveActiveSquadLoot(tag_LOOT_CORPFILES);
				giveActiveSquadLoot(tag_LOOT_CORPFILES);
				juiceparty(50, 1000);
				sitecrime += 40;
				int time = 20 + LCSrandom(10);
				if (time < 1)time = 1;
				if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
				pressAnyKey();
			}
			if (actual)
			{
				alienationcheck(0);
				noticecheck(-1);
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
				sitecrime += 3;
				addCrimeToSiteStory(CRIME_CORP_FILES);
				criminalizeparty(LAWFLAG_THEFT);
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_radio_broadcaststudio()
{
	extern short sitealienate;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		if (isThereASiteAlarm() || sitealienate)
		{
			mvaddstrAlt(16, 1, CONST_mapspecials112, gamelog);
			mvaddstrAlt(17, 1, CONST_mapspecials118, gamelog);
			gamelog.newline();
			addstrAlt(CONST_mapspecials119);
		}
		else
		{
			mvaddstrAlt(16, 1, CONST_mapspecials115, gamelog);
			gamelog.newline();
			mvaddstrAlt(17, 1, CONST_mapspecials116);
		}
		int c = getkeyAlt();
		if (c == 'y')
		{
			if (run_broadcast(false))
			{
				claimSiteStory();
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_news_broadcaststudio()
{
	extern short sitealienate;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		if (isThereASiteAlarm() || sitealienate)
		{
			mvaddstrAlt(16, 1, CONST_mapspecials117, gamelog);
			mvaddstrAlt(17, 1, CONST_mapspecials118);
			gamelog.newline();
			addstrAlt(CONST_mapspecials119);
		}
		else
		{
			mvaddstrAlt(16, 1, CONST_mapspecials120, gamelog);
			mvaddstrAlt(17, 1, CONST_mapspecials121);
		}
		int c = getkeyAlt();
		if (c == 'y')
		{
			if (run_broadcast(true))
			{
				claimSiteStory();
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_display_case()
{
	extern int sitecrime;
	extern short sitealarmtimer;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	while (true)
	{
		clearmessagearea();
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials122, gamelog);
		mvaddstrAlt(17, 1, CONST_mapspecials123);
		int c = getkeyAlt();
		if (c == 'y')
		{
			int time = 20 + LCSrandom(10);
			if (time < 1)time = 1;
			if (sitealarmtimer > time || sitealarmtimer == -1)sitealarmtimer = time;
			alienationcheck(0);
			noticecheck(-1, DIFFICULTY_HEROIC);
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].flag |= SITEBLOCK_DEBRIS;
			sitecrime++;
			juiceparty(5, 100);
			addCrimeToSiteStory(CRIME_VANDALISM);
			criminalizeparty(LAWFLAG_VANDALISM);
			return;
		}
		else if (c == 'n')return;
	}
}
void spawn_security()
{
	extern short cursite;
	// add a bouncer if there isn't one in the first slot
	if (!isThereASiteAlarm() && !getEncounterNameAndAlignment()[0].exists)
	{
		switch (LocationsPool::getInstance().getLocationType(cursite))
		{
		default:
		case SITE_CORPORATE_HEADQUARTERS:
		case SITE_CORPORATE_HOUSE:
		case SITE_BUSINESS_ARMSDEALER:
		case SITE_BUSINESS_BANK:
		case SITE_INDUSTRY_NUCLEAR:
			makecreature(0, CREATURE_MERC);
			makecreature(1, CREATURE_MERC);
			break;
		case SITE_GOVERNMENT_POLICESTATION:
		case SITE_GOVERNMENT_COURTHOUSE:
		case SITE_OUTDOOR_PUBLICPARK:
			makecreature(0, CREATURE_COP);
			makecreature(1, CREATURE_COP);
			break;
		case SITE_GOVERNMENT_PRISON:
			makecreature(0, CREATURE_PRISONGUARD);
			makecreature(1, CREATURE_PRISONGUARD);
			makecreature(2, CREATURE_GUARDDOG);
			break;
		case SITE_GOVERNMENT_WHITE_HOUSE:
			makecreature(0, CREATURE_SECRET_SERVICE);
			makecreature(1, CREATURE_SECRET_SERVICE);
			makecreature(2, CREATURE_SECRET_SERVICE);
			makecreature(3, CREATURE_SECRET_SERVICE);
			break;
		case SITE_GOVERNMENT_INTELLIGENCEHQ:
			makecreature(0, CREATURE_AGENT);
			makecreature(1, CREATURE_AGENT);
			makecreature(2, CREATURE_GUARDDOG);
			break;
		case SITE_GOVERNMENT_ARMYBASE:
			makecreature(0, CREATURE_MILITARYPOLICE);
			makecreature(1, CREATURE_MILITARYPOLICE);
			break;
		case SITE_BUSINESS_BARANDGRILL:
		case SITE_RESIDENTIAL_BOMBSHELTER:
		case SITE_OUTDOOR_BUNKER:
			if (LocationsPool::getInstance().get_specific_integer(INT_GETRENTINGTYPE,cursite) == RENTING_CCS)
			{
				makecreature(0, CREATURE_CCS_VIGILANTE);
				makecreature(1, CREATURE_CCS_VIGILANTE);
			}
		}
	}
}
void special_security(bool metaldetect)
{
	extern short cursite;
	extern short sitetype;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	extern DeprecatedCreature encounter[ENCMAX];
	char autoadmit = 0;
	emptyEncounter();
	spawn_security();
	{
		autoadmit = doWeHaveASleeperHere(cursite);
		string name = getSleeperSecurityName(cursite, encounter[0].type);
		if (name.size()) {
			autoadmit = 2;
			strcpy(encounter[0].name, name.data());
			encounter[0].align = 1;
			encounter[0].cantbluff = 1;
		}
	}
	//clearmessagearea();
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	moveAlt(16, 1);
	if (isThereASiteAlarm())
	{
		addstrAlt(CONST_mapspecials124, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = SPECIAL_NONE;
		return;
	}
	else if (autoadmit)
	{
		addstrAlt(CONST_mapspecials125, gamelog);
		metaldetect = false;
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = SPECIAL_SECURITY_SECONDVISIT;
	}
	else
	{
		if (metaldetect) addstrAlt(CONST_mapspecials126, gamelog);
		else addstrAlt(CONST_mapspecials127, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = SPECIAL_SECURITY_SECONDVISIT;
	}
	printencounter();
	pressAnyKey();
	char rejected = checkActiveSquadForRejection(autoadmit, metaldetect);
	moveAlt(17, 1);
	if (caseRejectionReasons.count(rejected)) {
		set_color_easy(RED_ON_BLACK_BRIGHT);
		addstrAlt(pickrandom(caseRejectionReasons[rejected]), gamelog);
	}
	else
		switch (rejected)
		{
		case REJECTED_NUDE:
			set_color_easy(RED_ON_BLACK_BRIGHT);
			if (autoadmit) addstrAlt(CONST_mapspecials128, gamelog);
			else addstrAlt(pickrandom(caseREJECTED_NUDE), gamelog);
			gamelog.newline();
			break;
		case REJECTED_WEAPONS:
			set_color_easy(RED_ON_BLACK_BRIGHT);
			if (metaldetect)
			{
				addstrAlt(CONST_mapspecials129, gamelog);
				setSiteAlarmOne();
			}
			else addstrAlt(pickrandom(caseREJECTED_WEAPONS), gamelog);
			gamelog.newline();
			break;
		case NOT_REJECTED:
			set_color_easy(GREEN_ON_BLACK_BRIGHT);
			addstrAlt(pickrandom(caseNOT_REJECTED), gamelog);
			gamelog.newline();
			break;
		}
	pressAnyKey();
	set_color_easy(WHITE_ON_BLACK_BRIGHT);
	for (int dx = -1; dx <= 1; dx++)
		for (int dy = -1; dy <= 1; dy++)
		{
			if (levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag & SITEBLOCK_DOOR)
			{
				if (rejected < NOT_REJECTED)
				{
					levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag |= SITEBLOCK_LOCKED;
					levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag |= SITEBLOCK_CLOCK;
				}
				else levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
			}
		}
	encounter[0].cantbluff = 1;
}
void special_security_checkpoint()
{
	special_security(false);
}
void special_security_metaldetectors()
{
	special_security(true);
}
void special_security_secondvisit()
{
	spawn_security();
}
void special_bank_vault()
{
	extern Deprecatednewsstoryst *sitestory;
	extern Deprecatedsquadst *activesquad;
	extern short cursite;
	extern int sitecrime;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	clearmessagearea();
	mvaddstrAlt(16, 1, CONST_mapspecials130, gamelog);
	mvaddstrAlt(17, 1, CONST_mapspecials131, gamelog);
	gamelog.newline();
	pressAnyKey();
	clearmessagearea();
	mvaddstrAlt(16, 1, CONST_mapspecials132, gamelog);
	mvaddstrAlt(17, 1, CONST_mapspecials133, gamelog);
	gamelog.newline();
	pressAnyKey();
	{
		string sleeperBanker = getSleeperBankerName(cursite);
		if (sleeperBanker.size()) {
			clearmessagearea();
			mvaddstrAlt(16, 1, string_sleeper, gamelog);
			addstrAlt(sleeperBanker, gamelog);
			addstrAlt(CONST_mapspecials134, gamelog);
			mvaddstrAlt(17, 1, CONST_mapspecials135, gamelog);
			gamelog.newline();
			pressAnyKey();
		}
	}
	while (true)
	{
		clearmessagearea();
		mvaddstrAlt(16, 1, CONST_mapspecials136);
		int c = getkeyAlt();
		if (c == 'y')
		{
			char actual;
			clearmessagearea();
			set_color_easy(WHITE_ON_BLACK_BRIGHT);
			mvaddstrAlt(16, 1, CONST_mapspecials137, gamelog);
			mvaddstrAlt(17, 1, CONST_mapspecials138, gamelog);
			gamelog.newline();
			pressAnyKey();
			if (!unlock(UNLOCK_VAULT, actual))
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials139, gamelog);
				mvaddstrAlt(17, 1, CONST_mapspecials140, gamelog);
				gamelog.newline();
				pressAnyKey();
				levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
			}
			else
			{
				clearmessagearea();
				set_color_easy(WHITE_ON_BLACK_BRIGHT);
				mvaddstrAlt(16, 1, CONST_mapspecials141, gamelog);
				mvaddstrAlt(17, 1, CONST_mapspecials142, gamelog);
				gamelog.newline();
				pressAnyKey();
				if (!hack(HACK_VAULT, actual))
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials143, gamelog);
					gamelog.newline();
					pressAnyKey();
					levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
				}
				else
				{
					clearmessagearea();
					set_color_easy(WHITE_ON_BLACK_BRIGHT);
					mvaddstrAlt(16, 1, CONST_mapspecials144, gamelog);
					mvaddstrAlt(17, 1, CONST_mapspecials145, gamelog);
					gamelog.newline();
					pressAnyKey();
					DeprecatedCreature *manager = 0;
					bool canbreakin = false;
					for (int s = 0; s < 6; s++)
					{
						DeprecatedCreature *c = activesquad->squad[s];
						if (c)
						{
							if (c->type == CREATURE_BANK_MANAGER)
							{
								manager = c;
								if (c->joindays < 30 && !(c->flag & CREATUREFLAG_KIDNAPPED))
								{
									clearmessagearea();
									set_color_easy(WHITE_ON_BLACK_BRIGHT);
									mvaddstrAlt(16, 1, c->name, gamelog);
									addstrAlt(CONST_mapspecials146, gamelog);
									gamelog.newline();
									pressAnyKey();
									canbreakin = true;
									break;
								}
							}
							if (c->prisoner && c->prisoner->type == CREATURE_BANK_MANAGER)
							{
								clearmessagearea();
								set_color_easy(WHITE_ON_BLACK_BRIGHT);
								mvaddstrAlt(16, 1, CONST_mapspecials147, gamelog);
								gamelog.newline();
								pressAnyKey();
								canbreakin = true;
								break;
							}
						}
					}
					if (!canbreakin)
					{
						string sleeperBankRobber = haveSleeperBankerCrackSafe(cursite, activesquad->squad[0]->base);
						if (sleeperBankRobber.size()) {
							clearmessagearea();
							set_color_easy(WHITE_ON_BLACK_BRIGHT);
							mvaddstrAlt(16, 1, string_sleeper, gamelog);
							addstrAlt(sleeperBankRobber, gamelog);
							addstrAlt(CONST_mapspecials148, gamelog);
							mvaddstrAlt(17, 1, CONST_mapspecials149, gamelog);
							gamelog.newline();
							pressAnyKey();
							canbreakin = true;
						}
					}
					if (canbreakin)
					{
						criminalizeparty(LAWFLAG_BANKROBBERY);
						sitecrime += 20;
						sitestory->crime.push_back(CRIME_BANKVAULTROBBERY);
						levelmap[loc_coord.locx + 1][loc_coord.locy][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
						levelmap[loc_coord.locx - 1][loc_coord.locy][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
						levelmap[loc_coord.locx][loc_coord.locy + 1][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
						levelmap[loc_coord.locx][loc_coord.locy - 1][loc_coord.locz].flag &= ~SITEBLOCK_DOOR;
						levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
					}
					else
					{
						if (manager)
						{
							clearmessagearea();
							set_color_easy(WHITE_ON_BLACK_BRIGHT);
							mvaddstrAlt(16, 1, manager->name, gamelog);
							addstrAlt(CONST_mapspecials150, gamelog);
							gamelog.newline();
							pressAnyKey();
						}
						else
						{
							clearmessagearea();
							set_color_easy(WHITE_ON_BLACK_BRIGHT);
							mvaddstrAlt(16, 1, CONST_mapspecials151, gamelog);
							gamelog.newline();
							pressAnyKey();
						}
					}
				}
			}
			if (actual)
			{
				alienationcheck(0);
				noticecheck(-1);
			}
			return;
		}
		else if (c == 'n')return;
	}
}
void special_bank_teller()
{
	extern short cursite;
	extern short sitealienate;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	if (isThereASiteAlarm() || sitealienate ||
		LocationsPool::getInstance().isThereASiegeHere(cursite))
	{
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials152, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
		pressAnyKey();
	}
	else
	{
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials153, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
		pressAnyKey();
		emptyEncounter();
		makecreature(0, CREATURE_BANK_TELLER);
	}
}
void giveActiveSquadMoney(const int money);
void special_bank_money()
{
	extern short sitealarmtimer;
	extern int sitecrime;
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern short postalarmtimer;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	static int swat_counter = 0;
	clearmessagearea(false);
	set_color_easy(GREEN_ON_BLACK_BRIGHT);
	mvaddstrAlt(16, 1, CONST_mapspecials154, gamelog);
	gamelog.newline();
	levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
	giveActiveSquadMoney(20000);
	sitecrime += 20;
	if (postalarmtimer <= 80) swat_counter = 0;
	if (!isThereASiteAlarm() && sitealarmtimer != 0) sitealarmtimer = 0;
	else if (!isThereASiteAlarm() && !LCSrandom(2)) setSiteAlarmOne();
	else if (isThereASiteAlarm() && postalarmtimer <= 60) postalarmtimer += 20;
	else if (isThereASiteAlarm() && postalarmtimer <= 80 && LCSrandom(2)) postalarmtimer = 81;
	else if (isThereASiteAlarm() && postalarmtimer > 80 && LCSrandom(2) && swat_counter < 2)
	{
		pressAnyKey();
		if (swat_counter > 0)
			mvaddstrAlt(17, 1, CONST_mapspecials155, gamelog);
		else
			mvaddstrAlt(17, 1, CONST_mapspecials156, gamelog);
		gamelog.newline();
		swat_counter++;
		int swatnum = 9;
		fillEncounter(CREATURE_SWAT, swatnum);
	}
	pressAnyKey();
}
void spawnPresident();
void special_oval_office()
{
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	// Clear entire Oval Office area
	for (int dx = -1; dx <= 1; dx++)
		for (int dy = -1; dy <= 1; dy++)
		{
			if (levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].special == SPECIAL_OVAL_OFFICE_NW ||
				levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].special == SPECIAL_OVAL_OFFICE_NE ||
				levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].special == SPECIAL_OVAL_OFFICE_SW ||
				levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].special == SPECIAL_OVAL_OFFICE_SE)
			{
				levelmap[loc_coord.locx + dx][loc_coord.locy + dy][loc_coord.locz].special = -1;
			}
		}
	if (isThereASiteAlarm())
	{
		emptyEncounter();
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials157, gamelog);
		printsitemap(loc_coord.locx, loc_coord.locy, loc_coord.locz);
		pressAnyKey();
		mvaddstrAlt(17, 1, CONST_mapspecials158, gamelog);
		gamelog.newline();
		for (int e = 0; e < 6; e++)makecreature(e, CREATURE_SECRET_SERVICE);
		printencounter();
		pressAnyKey();
		enemyattack();
		creatureadvance();
	}
	else
	{
		emptyEncounter();
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials159, gamelog);
		gamelog.newline();
		printsitemap(loc_coord.locx, loc_coord.locy, loc_coord.locz);
		for (int e = 0; e < 2; e++)makecreature(e, CREATURE_SECRET_SERVICE);
		spawnPresident();
		printencounter();
		pressAnyKey();
	}
}
void special_ccs_boss()
{
	extern Log gamelog;
	extern coordinatest loc_coord;
	extern short cursite;
	extern short sitealienate;
	extern siteblockst levelmap[MAPX][MAPY][MAPZ];
	if (isThereASiteAlarm() || sitealienate ||
		LocationsPool::getInstance().isThereASiegeHere(cursite))
	{
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials160, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
		pressAnyKey();
		emptyEncounter();
		makecreature(0, CREATURE_CCS_ARCHCONSERVATIVE);
		makecreature(1, CREATURE_CCS_VIGILANTE);
		makecreature(2, CREATURE_CCS_VIGILANTE);
		makecreature(3, CREATURE_CCS_VIGILANTE);
		makecreature(4, CREATURE_CCS_VIGILANTE);
		makecreature(5, CREATURE_CCS_VIGILANTE);
	}
	else
	{
		clearmessagearea(false);
		set_color_easy(WHITE_ON_BLACK_BRIGHT);
		mvaddstrAlt(16, 1, CONST_mapspecials161, gamelog);
		gamelog.newline();
		levelmap[loc_coord.locx][loc_coord.locy][loc_coord.locz].special = -1;
		pressAnyKey();
		emptyEncounter();
		makecreature(0, CREATURE_CCS_ARCHCONSERVATIVE);
	}
}